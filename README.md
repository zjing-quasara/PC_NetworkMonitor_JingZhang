# 电脑端网络监控工具

独立的网络监控工具，用于测试时记录电脑的网络状况。

## 功能特性

- ✅ 图形界面，简单易用
- ✅ 持续ping目标服务器
- ✅ 实时显示网络状态
- ✅ 记录延迟和丢包率
- ✅ 时间戳精确到毫秒
- ✅ 导出CSV格式日志

---

## 快速开始

### 方式1：图形界面（推荐）⭐

**命令行运行：**
```bash
python gui.py
```

**使用步骤：**
1. 输入目标服务器地址（与手机APP填写相同）
2. 设置采样间隔（默认1秒）
3. 点击「开始监控」
4. 进行测试（录制视频等）
5. 点击「停止监控」
6. 点击「保存日志」导出CSV文件

### 方式2：命令行版

**交互式：**
```bash
python main.py
```

**代码调用：**
```python
from src.core.monitor import NetworkMonitor
import time

monitor = NetworkMonitor(
    name="电脑端",
    targets=["api.link.aliyun.com"],
    interval=1.0
)

monitor.start()
time.sleep(60)  # 监控60秒
monitor.stop()
monitor.save_log("network_log.csv")
```

---

## 界面预览

```
╔══════════════════════════════════════════════╗
║          📡 电脑端网络监控                      ║
╠══════════════════════════════════════════════╣
║ 监控配置                                      ║
║   目标服务器: [api.link.aliyun.com    ]       ║
║   采样间隔:   [1.0] 秒                        ║
║                                              ║
║   [▶ 开始监控]  [⏹ 停止监控]                  ║
║                                              ║
║ 实时状态                                      ║
║   ● 监控中                                    ║
║   运行时间: 30秒                              ║
║                                              ║
║   总请求数: 30    平均延迟: 45 ms             ║
║   成功数:   28    最小延迟: 42 ms             ║
║   超时数:   2     最大延迟: 120 ms            ║
║                                              ║
║   最新ping:                                   ║
║   [12:34:56] api.link.aliyun.com: 45 ms     ║
║                                              ║
║   [💾 保存日志]  [📂 打开日志文件夹]           ║
╚══════════════════════════════════════════════╝
```

---

## 使用场景

### 配合手机端监控使用

**完整测试流程：**

1. **电脑端：**
   - 运行 `python gui.py`
   - 输入服务器地址（如：`api.link.aliyun.com`）
   - 点击「开始监控」

2. **手机端：**
   - 打开安卓监控APP
   - 输入相同的服务器地址
   - 点击「开始监控」

3. **进行测试：**
   - 手机开始录屏
   - 操作App进行测试
   - 电脑和手机同时记录网络状态

4. **结束测试：**
   - 手机停止录屏和监控
   - 电脑点击「停止监控」→「保存日志」
   - 手机导出日志文件

5. **分析数据：**
   - 得到3个文件：
     - `video_analysis.csv` - 视频分析结果
     - `network_log_phone.csv` - 手机网络日志
     - `network_log_pc.csv` - 电脑网络日志
   - 导入视频延时分析工具进行关联分析

---

## 对比诊断

通过对比电脑和手机的网络日志，可以定位问题：

| 现象 | 手机网络 | 电脑网络 | 诊断结论 |
|-----|---------|---------|---------|
| App延迟高 | 延迟高/丢包 | 正常 | **手机WiFi信号差** |
| App延迟高 | 正常 | 延迟高/丢包 | 电脑网络问题（不太可能） |
| App延迟高 | 延迟高/丢包 | 延迟高/丢包 | **网络环境问题**（路由器/宽带/云服务器） |
| App延迟高 | 正常 | 正常 | 网络正常，是**应用层问题** |

---

## 输出格式

CSV文件格式：

```csv
timestamp,datetime,target,ping_ms,packet_loss,status
1702652400.123,2023-12-15 16:00:00.123,api.link.aliyun.com,45.20,0.00,ok
1702652401.234,2023-12-15 16:00:01.234,api.link.aliyun.com,48.50,0.00,ok
1702652402.345,2023-12-15 16:00:02.345,api.link.aliyun.com,,1.00,timeout
```

**字段说明：**
- `timestamp`: Unix时间戳（秒，与视频分析对齐）
- `datetime`: 可读时间格式
- `target`: 目标服务器地址
- `ping_ms`: ping延迟（毫秒）
- `packet_loss`: 丢包率（0-1）
- `status`: 状态（ok/timeout/error）

---

## 系统要求

- **操作系统：** Windows 7+
- **Python：** 3.6+
- **依赖：** 仅Python标准库（无需额外安装）

---

## 注意事项

### ⚠️ 重要提示

1. **相同服务器：** 电脑和手机必须ping同一个服务器地址
2. **时间同步：** 确保电脑和手机时间准确（用于时间戳对齐）
3. **同时运行：** 监控要和视频录制同时开始和结束
4. **防火墙：** 确保允许ping（ICMP协议）

### 💡 使用技巧

- **采样间隔：** 一般设置1秒，如果需要更高精度可以设置0.5秒
- **服务器选择：** 
  - 测试国内服务器：`www.baidu.com`
  - 测试云服务器：`api.link.aliyun.com`（填实际地址）
- **网络稳定：** 监控期间不要下载大文件，避免影响测试

---

## 常见问题

### Q: 显示"ping不通"怎么办？

**检查步骤：**
1. 服务器地址是否正确
2. 网络连接是否正常
3. 防火墙是否阻止ping
4. 尝试换个服务器测试（如：`www.baidu.com`）

### Q: 延迟一直很高？

**可能原因：**
- 服务器在国外（延迟100-300ms是正常的）
- 网络拥堵（高峰时段）
- 路由器性能差
- 其他程序占用带宽

**解决方案：**
- 关闭其他占用网络的程序
- 重启路由器
- 换个时间段测试

### Q: 日志保存在哪里？

**默认位置：** 自己选择保存位置

也可以点击界面上的「📂 打开日志文件夹」按钮，快速打开工具目录。

### Q: 可以同时监控多个服务器吗？

**图形界面版：** 不支持（简化操作）

**命令行版：** 支持
```python
from src.core.monitor import NetworkMonitor

monitor = NetworkMonitor(
    targets=["www.baidu.com", "api.link.aliyun.com"],  # 多个目标
    interval=1.0
)
```

---

## 项目结构

```
pc_network_monitor/
├── src/                      # 源代码目录
│   ├── core/                # 核心功能模块
│   │   ├── __init__.py
│   │   └── monitor.py      # 网络监控核心类
│   ├── gui/                 # GUI界面模块
│   │   ├── __init__.py
│   │   └── main_window.py  # 主窗口类
│   └── utils/               # 工具模块
│       ├── __init__.py
│       └── config.py       # 配置管理
├── main.py                  # 命令行程序入口
├── gui.py                   # GUI程序入口
├── config.json              # 配置文件（自动生成）
└── README.md                # 使用说明
```

---

## 技术细节

- **界面框架：** tkinter（Python标准库）
- **采样精度：** 毫秒级时间戳
- **后台运行：** 多线程，不阻塞界面
- **跨平台：** 自动适配Windows/Linux/Mac的ping命令
- **无弹窗：** ping命令静默运行

---

**版本:** v2.0  
**更新:** 2025-12-17  
**作者:** Dreame测试团队
